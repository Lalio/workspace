var $searchBd=$(".search-bd"),searchInfo=["\u6e05\u534e\u5927\u5b66 C\u8bed\u8a00","\u6709\u6ca1\u6709\u300a\u6982\u7387\u8bba\u300b\u7684\u8bfe\u4ef6","\u5b9e\u9a8c\u62a5\u544a\u80fd\u4e0d\u80fd\u53c2\u8003\u4e00\u4e0b"],searchIndex=0,infoLen=searchInfo.length;!function(){var b={indexUrl:"//api.xzbbm.cn/?action\x3dSuperAPI",backToTop:function(){var a=$(".gotop");$(window).on("scroll",function(){180<$(window).scrollTop()?a.addClass("gotop-show"):a.removeClass("gotop-show")});a.on("click",function(){$("html,body").animate({scrollTop:"0px"},800)})},loginControl:function(){$(".user-login").on("click",function(){$("#login-popbox .form-input").val("");$("#login-error-tips").html("");wilson.popupBox("none",{boxSelector:".login-popbox"})});$(".forget-pass,#findback-form-submit").on("click",function(){$(".J_maskLayer,.popbox").hide();wilson.popupBox("none",{boxSelector:".sendemail-popbox"})});$(".toregister").on("click",function(){$("#register-popbox .password,#register-form-submit").show();$("#findback-form-submit,.finback-tips").hide();$("#register-popbox .form-input").val("");$("#register-error-tips").html("");$(".J_maskLayer,.popbox").hide();wilson.popupBox("none",{boxSelector:".register-popbox"})})},registerControl:function(){$(".user-register").on("click",function(){$("#register-popbox .password,#register-form-submit,#register-code,#code-img-register").show();$("#findback-form-submit,.finback-tips").hide();$("#register-popbox .form-input").val("");$("#register-error-tips").html("");wilson.popupBox("none",{boxSelector:".register-popbox"})})},getLoginCookie:function(){$.cookie("xztoken")&&($(".user-btn").hide(),$(".hd-control .user-name").html($.cookie("user_name")),$(".hd-control .user-name,.hd-control .logout").show())},register:function(){var a=!1;$("#register-popbox .email").on("blur",function(){var c=$.trim($("#register-popbox .email").val());""===c?($("#register-error-tips").html("\u90ae\u7bb1\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a\uff01"),a=!1):/([a-z0-9]*[-_.]?[a-z0-9]+)*@([a-z0-9]*[-_]?[a-z0-9]+)+[.][a-z]{2,3}([.][a-z]{2})?/i.test(c)?($(".email-loading").show(),$.ajax({url:b.indexUrl+'\x26do\x3dWebTestEmail\x26debug\x3don\x26msg\x3d{"email":"'+c+'"}',type:"get",dataType:"jsonp",success:function(b){$(".email-loading").hide();0===b.rcode?(a=!0,$("#register-error-tips").html("")):b.isOk||(a=!1,"\u4eb2\uff0c\u4f60\u7684\u90ae\u7bb1\u53f7\u7801\u5df2\u6ce8\u518c\uff01"==b.error?($("#register-popbox .password,#register-form-submit,#register-code,#code-img-register").hide(),$("#findback-form-submit,.finback-tips").show()):$("#register-error-tips").html(b.error))}})):($("#register-error-tips").html("\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u5efa\u8bae\u4f7f\u7528QQ\u6216\u7f51\u6613\u90ae\u7bb1\uff01"),a=!1)});$("#register-form-submit").on("click",function(c){c.preventDefault();var d=$.trim($("#register-popbox .email").val());c=$.trim($("#register-popbox .password").val());var e=$.trim($("#register-popbox .code").val());""===d||""===c||""===e?($("#register-error-tips").html("\u90ae\u7bb1,\u5bc6\u7801\u6216\u8005\u9a8c\u8bc1\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff01"),a=!1):a&&($(".submit-loading").show(),$.ajax({url:b.indexUrl+'\x26do\x3dWebRegister\x26debug\x3don\x26msg\x3d{"email":"'+d+'","password":"'+c+'","yzm":"'+e+'","xztoken":"'+$("#xztoken").val()+'"}',type:"get",dataType:"jsonp",success:function(a){$(".submit-loading").hide();a.isOk||"undefined"==typeof a.isOk?($(".J_maskLayer,#register-popbox").hide(),wilson.popupBox("none",{boxSelector:"#success-popbox"}),$("#success-popbox .success-email").html(d)):$("#register-error-tips").html(a.error)}}))})},login:function(){$("#login-form-submit").on("click",function(a){a.preventDefault();a=$.trim($("#login-popbox .email").val());var c=$.trim($("#login-popbox .password").val()),d=$.trim($("#login-popbox .code").val());""===a||""===c||""==d?$("#login-error-tips").html("\u7528\u6237\u540d\uff0c\u5bc6\u7801\u6216\u8005\u9a8c\u8bc1\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff01"):($(".submit-loading").show(),$.ajax({url:b.indexUrl+'\x26do\x3dWebLogin\x26debug\x3don\x26msg\x3d{"email":"'+a+'","password":"'+c+'","yzm":"'+d+'"}',type:"get",dataType:"jsonp",success:function(a){$(".submit-loading").hide();a.isOk||"undefined"==typeof a.isOk?($(".J_maskLayer,#login-popbox,.user-btn").hide(),$(".hd-control .user-name,.hd-control .logout").show(),$(".hd-control .user-name").html(a.user.user_name),$.cookie("userid",a.user.userid,{path:"/",expires:7}),$.cookie("phone",a.user.phone,{path:"/",expires:7}),$.cookie("email",a.user.email,{path:"/",expires:7}),$.cookie("user_name",a.user.user_name,{path:"/",expires:7}),$.cookie("xztoken",a.user.xztoken,{path:"/",expires:7}),$.cookie("user_icon",a.user.user_icon,{path:"/",expires:7}),$.cookie("ccode",a.user.ccode,{path:"/",expires:7}),$.cookie("ucode",a.user.ucode,{path:"/",expires:7}),$.cookie("uploadCcode",a.user.ccode,{path:"/",expires:7}),$.cookie("uploadUcode",a.user.ucode,{path:"/",expires:7}),location.reload()):($("#login-error-tips").html(a.error),this.changeCodeImg())}}))})},changeCodeImg:function(){$("#login-code,#register-code").on("focus",function(){var a='\x3cimg src\x3d"'+(b.indexUrl+"\x26do\x3dGVerifyCode\x26headerType\x3dpng\x26ts\x3d"+Math.random())+'" class\x3d"code-img" alt\x3d""\x3e';$(this).next("a").html(a)});$("#code-img-login,#code-img-register").on("click",function(){var a='\x3cimg src\x3d"'+(b.indexUrl+"\x26do\x3dGVerifyCode\x26headerType\x3dpng\x26ts\x3d"+Math.random())+'" class\x3d"code-img" alt\x3d""\x3e';$(this).html(a)})},logout:function(){$(".logout").on("click",function(){$.cookie("email",null);$.cookie("phone",null);$.cookie("xztoken",null);$.cookie("ccode",null);$.cookie("ucode",null);$.cookie("findback_email",null);$.cookie("user_icon",null);$.cookie("reset_token",null);$.cookie("userid",null);$.cookie("user_name",null);$.cookie("uploadUcode",null);$.cookie("uploadCcode",null);location.reload()})},emailTimer:null,sendEmail:function(){$("#sendemail-form-submit").on("click",function(){clearInterval(b.emailTimer);var a=$.trim($("#sendemail").val());""===a?$("#sendmail-error-tips").html("\u90ae\u7bb1\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a\uff01"):/([a-z0-9]*[-_.]?[a-z0-9]+)*@([a-z0-9]*[-_]?[a-z0-9]+)+[.][a-z]{2,3}([.][a-z]{2})?/i.test(a)?($.cookie("findback_email",a),b.sendEmailAjax(a)):$("#sendmail-error-tips").html("\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u5efa\u8bae\u4f7f\u7528QQ\u6216\u7f51\u6613\u90ae\u7bb1\u3002\uff01")})},sendFile:function(){$("#sendfile-form-submit").on("click",function(){clearInterval(b.emailTimer);var a=$.trim($("#sendfile").val())?$.trim($("#sendfile").val()):$.cookie("email"),c=$.trim($(this).attr("file_index"));""===a?$("#sendfile-error-tips").html("\u90ae\u7bb1\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a\uff01"):/([a-z0-9]*[-_.]?[a-z0-9]+)*@([a-z0-9]*[-_]?[a-z0-9]+)+[.][a-z]{2,3}([.][a-z]{2})?/i.test(a)?b.sendFileAjax(a,c):$("#sendfile-error-tips").html("\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e\uff01")})},sendFileAjax:function(a,c){$(".submit-loading").show();$.ajax({url:b.indexUrl+'\x26do\x3dSendMail\x26debug\x3don\x26msg\x3d{"file_index":"'+c+'","xztoken":"'+$.cookie("xztoken")+'","email":"'+a+'"}',type:"get",dataType:"jsonp",success:function(a){$(".submit-loading").hide();if(1==a.rcode)$("#sendfile-error-tips").html(a.error);else{$(".J_maskLayer").hide();wilson.popupBox("none",{boxSelector:".sendefile-success-popbox"});var c=4;b.emailTimer=setInterval(function(){1==c&&location.reload();$(".countdown").html(c--)},1E3)}}})},sendEmailAjax:function(a){$(".submit-loading").show();var c=!1;$.ajax({url:b.indexUrl+'\x26do\x3dWebChangePassword\x26debug\x3don\x26msg\x3d{"temp_ip":"http://xzbbm.cn/index.html","email":"'+a+'"}',type:"get",dataType:"jsonp",success:function(d){$(".submit-loading").hide();$(".J_maskLayer,#sendemail-popbox").hide();wilson.popupBox("none",{boxSelector:".sendemail-success-popbox"});$(".success-email").html(a);$(".countdown").off("click",function(){b.sendEmailAjax(a)});c=!1;$("#resend").addClass("nonsend");var e=59;b.emailTimer=setInterval(function(){0==e&&(clearInterval(b.emailTimer),c=!0,$("#resend").removeClass("nonsend"),$("#resend").on("click",function(){c&&(b.sendEmailAjax(a),c=!1)}));$(".countdown").html(e--)},1E3)}})},userToIndex:function(){-1==window.location.href.indexOf("user")||$.cookie("xztoken")||(window.location="http://xzbbm.cn")},placeHolder:function(){$(".form-input").placeholder();var a=setInterval(function(){$searchBd[0].setAttribute("placeholder",searchInfo[searchIndex]);searchIndex<infoLen-1?searchIndex++:searchIndex=0},5E3);$searchBd.on("focus",function(){clearInterval(a)})},init:function(){this.getLoginCookie();this.backToTop();this.loginControl();this.registerControl();this.register();this.login();this.changeCodeImg();this.logout();this.sendEmail();this.userToIndex();this.placeHolder();this.sendFile()}};"undefined"!==typeof b&&(window.common=b);b.init()}();$.extend({getUrlVars:function(){for(var b=[],a,c=window.location.href.slice(window.location.href.indexOf("?")+1).split("\x26"),d=0;d<c.length;d++)a=c[d].split("\x3d"),b.push(a[0]),b[a[0]]=a[1];return b},getUrlVar:function(b){return $.getUrlVars()[b]}});